@page "/purchaserequisition/create"

<div class="row p-3">
    <div class="col-6">
        <h3>Create Purchase Requisition</h3>
    </div>
    <div class="col-6 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary rounded-pill">Submit</button>
    </div>
</div>
<div class="row m-3 p-3 rounded-3 shadow-sm bg-light">
    <!-- Purchase Requisition Form -->
    <form class="row g-3">
        <div class="col-md-6">
            <label class="form-label">Purchase Requisition Number</label>
            <input type="text" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label">Creation Date</label>
            <input type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label">Company</label>
            <input type="text" class="form-control" placeholder="TechnoTrek">
        </div>
        <div class="col-md-6">
            <label class="form-label">Required By</label>
            <input type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label">Vendor</label>
            <input type="text" class="form-control">
        </div>
        @* <div class="col-md-4">
        <label class="form-label">State</label>
        <select class="form-select">
        <option selected>Choose...</option>
        <option>...</option>
        </select>
        </div>
        <div class="col-md-2">
        <label class="form-label">Zip</label>
        <input type="text" class="form-control">
        </div> *@
        @* <div class="col-12">
        <div class="form-check">
        <input class="form-check-input" type="checkbox" id="gridCheck">
        <label class="form-check-label" for="gridCheck">
        Check me out
        </label>
        </div>
        </div> *@
    </form>
</div>

<div class="row m-3 p-3 rounded-3 shadow-sm bg-light">
    <h5>Items</h5>
    <form class="row g-3">
        <table class="table table-bordered border-primary">
            <thead>
                <tr>
                    <th class="col col-auto">
                        <input type="checkbox" @onchange="ToggleAllRowsSelection" />
                        No.
                    </th>
                    <th class="col col-auto">
                        Item
                    </th>
                    <th class="col col-auto">
                        Quantity
                    </th>
                    <th class="col col-auto">
                        UOM
                    </th>
                    <th class="col col-auto">
                        Required By
                    </th>
                    <th class="col col-auto">Actions</th> <!-- Add a header for actions -->
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Rows will be added here dynamically -->
                @for (int index = 0; index < Items.Count; index++)
                {
                    var item = Items[index];
                    <tr>
                        <td>
                            <input type="checkbox" @bind="item.Selected" />
                            @(index + 1)
                        </td>
                        <td><input type="text" class="form-control" @bind="item.Name" /></td>
                        <td><input type="number" class="form-control" @bind="item.Quantity" /></td>
                        <td><input type="text" class="form-control" @bind="item.UOM" /></td>
                        <td>
                            <input type="date" class="form-control" @bind="item.RequiredBy" min="@DateTime.Now.ToString("dd-MM-yyyy")" />
                        </td>

                        <td>
                            <button class="btn btn-danger" @onclick:preventDefault @onclick="() => DeleteRow(index)" style="display: @(item.Selected ? "block" : "none")">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </form>
    <div class="col-12">
        <button class="btn btn-primary rounded-pill" @onclick="AddRow">Add Row</button>
    </div>
</div>


@code {
    private List<Item> Items { get; set; } = new List<Item>();

    private void AddRow()
    {
        Items.Add(new Item
            {
                RequiredBy = DateTime.Now, // Set the default date to the current date
            });
    }

    private void DeleteRow(int index)
    {
        for (int i = Items.Count - 1; i >= 0; i--)
        {
            if (Items[i].Selected)
            {
                Items.RemoveAt(i);
            }
        }
    }

    private record SimpleCallback(Action Callback) : IHandleEvent
    {
        public static Action Create(Action callback) => new SimpleCallback(callback).Invoke;

        public void Invoke() => Callback();
        public Task HandleEventAsync(EventCallbackWorkItem item, object arg) => Task.CompletedTask;
    }

    private void ToggleAllRowsSelection()
    {
        bool selectAll = Items.All(item => item.Selected);
        foreach (var item in Items)
        {
            item.Selected = !selectAll;
        }
    }

    private class Item
    {
        public string Name { get; set; }
        public int Quantity { get; set; }
        public string UOM { get; set; }
        public DateTime RequiredBy { get; set; }
        public bool Selected { get; set; }
    }
}
